<h1>Results for &lt;<%= link_to @site_title, site_path(@site) %>&gt; site</h1>
<!--div style="height:40px; overflow:hidden;"-->
<p style="  float: left;          line-height: 30px;          margin: 0 12px 0 0;           padding: 0;  ">
  <b>Site status:</b>
  <span site_id="<%= @site.id %>" class="<%= site_status_class @site %>"><%= @site.status %></span>
</p>
<%= run_button_for @site, false %>
<!--/div-->
<div style="clear:both;"></div>
<span id="filter_trigger" title="click to open filter">filter:</span><br/><br/>
<div id="filter">
  <h2>Filter</h2>

  <div class="form_hint">Filter options are joined with "AND" logic. Use % symbol in text fields as a wildcard (which
    means 'any number of arbitrary characters')
  </div>
  <%= form_tag site_results_path(@site), :method=> 'get' do %>
      <label title="Ref code starts with">Ref code: <%= text_field_tag :ref_code, params[:ref_code] %></label>
      <label title="Working title starts with">Working
        title: <%= text_field_tag :working_title, params[:working_title] %></label>
      <label title="Location starts with">Location: <%= text_field_tag :location, params[:location] %></label>
      <label title="Organization name starts with">Organization
        name: <%= text_field_tag :organization_name, params[:organization_name] %></label><label title="Brief description starts with">Brief
  description: <%= text_field_tag :brief_description, params[:brief_description] %></label>

      <label title="Time crawled not later than">Time
        crawled: <%= select_tag :time_span, options_for_select([
                                                                       ["all", 0],
                                                                       ["1 day ago", 24],
                                                                       ["3 days age", 72],
                                                                       ["last week", 144],
                                                                       ["last month", 720],
                                                                       ["last year", 8760]
                                                               ]) %></label>

      <div style="clear:both;"></div>
      <%= submit_tag "Search", :name => nil %>
  <% end %>
</div>
<%= paginate @results %>
<table cellpadding="0" cellspacing="1" class="db_table">
  <tr>
    <th>Ref code</th>
    <% fields_ids = [] %>
    <% @site.xpaths.each do |x| %>
        <% unless x.available_field.field_name == "html" || x.available_field.field_name == "ref_code" || x.show_in_index == 0 %>
            <% fields_ids.push x.id %>
            <th><%= x.available_field.field_name %></th>
        <% end %>
    <% end %>
    <th>Time crawled</th>
    <th colspan="2">Actions</th>
  </tr>

  <% @results.each do |result| %>
      <% fields = Result.fields_as_hash(result.result_fields) %>
      <tr class="data_row">
        <td><%= link_to result.ref_code, site_result_path(@site, result) %></td>
        <% fields_ids.each do |field_id| %>
            <td><%= truncate fields[field_id], :length => 150, :separator => ' ' %></td>
        <% end %>
        <td><%= result.time_crawled %></td>
        <td>
          <div id="button_result_<%= result.id %>" class="button_16" title="<%= t "hints.gears_button" %>"></div>
          <script>menus["button_result_<%= result.id %>"] = {
              items:[
                  {label:"Show", href:"<%= site_result_path @site,result %>" },
                  //{label:"Edit", href:"<%= edit_site_result_path  @site,result %>" }
              ]
          };
          </script>
        </td>
        <td><%= link_to image_tag('destroy.png', :border=>0), result_path(result)+"?site_id=#{@site.id}", :confirm => 'Are you sure?', :method => :delete, :title=>"Delete" %></td>
      </tr>
  <% end %>
</table>
<%= paginate @results %>
